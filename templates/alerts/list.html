{% extends 'base/base.html' %}
{% block title %}Alerts{% endblock %}
{% block breadcrumb %}ALERTS / ACTIVE{% endblock %}

{% block content %}

<div class="page-header fade-up">
  <div class="page-title-group">
    <div class="page-eyebrow">OPERATIONS / ALERTS</div>
    <h1 class="page-title">Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</h1>
    <p class="page-subtitle">{{ total_alerts }} Ù‡Ø´Ø¯Ø§Ø± ÙØ¹Ø§Ù„ â€” {{ critical_count }} Ø¨Ø­Ø±Ø§Ù†ÛŒ</p>
  </div>
  <div class="flex gap-3">
    <button class="btn btn-ghost" onclick="filterAlerts('all')" id="f-all">Ù‡Ù…Ù‡</button>
    <button class="btn btn-ghost" onclick="filterAlerts('critical')" id="f-critical">Ø¨Ø­Ø±Ø§Ù†ÛŒ</button>
    <button class="btn btn-ghost" onclick="filterAlerts('warning')" id="f-warning">Ù‡Ø´Ø¯Ø§Ø±</button>
  </div>
</div>

<!-- Stats -->
<div class="stat-grid fade-up stagger-1" style="grid-template-columns:repeat(3,1fr)">
  <div class="stat-card accent-red">
    <div class="stat-header"><div class="stat-icon-wrap">ğŸš¨</div></div>
    <div class="stat-value">{{ critical_count }}</div>
    <div class="stat-label">Ù‡Ø´Ø¯Ø§Ø± Ø¨Ø­Ø±Ø§Ù†ÛŒ</div>
  </div>
  <div class="stat-card accent-amber">
    <div class="stat-header"><div class="stat-icon-wrap">âš ï¸</div></div>
    <div class="stat-value">{{ warning_count }}</div>
    <div class="stat-label">Ù‡Ø´Ø¯Ø§Ø± Ù…Ø¹Ù…ÙˆÙ„ÛŒ</div>
  </div>
  <div class="stat-card accent-blue">
    <div class="stat-header"><div class="stat-icon-wrap">âœ…</div></div>
    <div class="stat-value">{{ resolved_today }}</div>
    <div class="stat-label">Ø±ÙØ¹ Ø´Ø¯Ù‡ Ø§Ù…Ø±ÙˆØ²</div>
  </div>
</div>

<!-- Alert Feed -->
<div class="panel mt-6 fade-up stagger-2">
  <div class="panel-header">
    <div>
      <div class="panel-title">ğŸ“‹ Ù„ÛŒØ³Øª Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ ÙØ¹Ø§Ù„</div>
      <div class="panel-subtitle">ACTIVE ALERTS â€” REAL-TIME</div>
    </div>
    <form method="post" action="/alerts/resolve-all/">
      {% csrf_token %}
      <button type="submit" class="btn btn-ghost btn-sm" onclick="return confirm('Ù‡Ù…Ù‡ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ Ø±ÙØ¹ Ø´ÙˆØ¯ØŸ')">
        Ø±ÙØ¹ Ù‡Ù…Ù‡
      </button>
    </form>
  </div>

  <div class="panel-body" style="padding:0">
    <div id="alerts-container" style="display:flex;flex-direction:column">
      {% for alert in alerts %}
      <div class="alert-feed-item {{ alert.severity }}" id="alert-{{ alert.pk }}"
           style="display:flex;align-items:flex-start;gap:var(--space-4);padding:var(--space-5) var(--space-6);border-bottom:1px solid var(--border-subtle);border-right:3px solid {% if alert.severity == 'critical' %}var(--crimson){% elif alert.severity == 'warning' %}var(--amber){% else %}var(--plasma){% endif %};transition:all 0.4s;background:{% if alert.severity == 'critical' %}rgba(255,34,68,0.03){% elif alert.severity == 'warning' %}rgba(255,184,0,0.02){% else %}transparent{% endif %}">

        <div style="width:40px;height:40px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;background:{% if alert.severity == 'critical' %}rgba(255,34,68,0.12){% elif alert.severity == 'warning' %}rgba(255,184,0,0.12){% else %}rgba(0,212,255,0.12){% endif %}">
          {% if alert.severity == 'critical' %}ğŸš¨{% elif alert.severity == 'warning' %}âš ï¸{% else %}â„¹ï¸{% endif %}
        </div>

        <div style="flex:1;min-width:0">
          <div style="display:flex;align-items:center;gap:var(--space-2);margin-bottom:4px">
            <span style="font-size:14px;font-weight:600;color:var(--text-primary)">{{ alert.device.name }}</span>
            <span class="badge {% if alert.severity == 'critical' %}badge-red{% elif alert.severity == 'warning' %}badge-amber{% else %}badge-blue{% endif %}">{{ alert.get_severity_display }}</span>
            <span class="badge badge-ghost">{{ alert.get_alert_type_display }}</span>
          </div>
          <div style="font-size:13px;color:var(--text-secondary);margin-bottom:6px;line-height:1.5">{{ alert.message }}</div>
          <div style="font-family:var(--font-mono);font-size:10px;color:var(--text-tertiary)">
            {{ alert.created_at|date:"Y/m/d H:i" }} â€” {{ alert.created_at|timesince }} Ù¾ÛŒØ´
            {% if alert.value %} â€” Ù…Ù‚Ø¯Ø§Ø±: <span style="color:var(--amber)">{{ alert.value }}</span>{% endif %}
            {% if alert.threshold %} â€” Ø­Ø¯: <span style="color:var(--text-secondary)">{{ alert.threshold }}</span>{% endif %}
          </div>
        </div>

        <div style="display:flex;align-items:center;gap:var(--space-2)">
          <a href="/monitor/{{ alert.device.pk }}/" class="btn btn-ghost btn-sm btn-icon" title="Ù…Ø§Ù†ÛŒØªÙˆØ± Ø¯Ø³ØªÚ¯Ø§Ù‡">
            <i class="fas fa-eye"></i>
          </a>
          <button class="btn btn-ghost btn-sm" onclick="resolveAlert({{ alert.pk }}, this)" title="Ø±ÙØ¹ Ù‡Ø´Ø¯Ø§Ø±" style="color:var(--acid);border-color:rgba(0,255,136,0.2)">
            <i class="fas fa-check"></i>
          </button>
        </div>

      </div>
      {% empty %}
      <div style="text-align:center;padding:80px 40px;color:var(--text-tertiary)">
        <div style="font-size:48px;margin-bottom:16px">âœ…</div>
        <div style="font-family:var(--font-display);font-size:20px;font-weight:700;color:var(--acid);margin-bottom:8px">ALL CLEAR</div>
        <div style="font-family:var(--font-mono);font-size:11px;letter-spacing:1px">Ù‡ÛŒÚ† Ù‡Ø´Ø¯Ø§Ø±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</div>
      </div>
      {% endfor %}
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function filterAlerts(type) {
  document.querySelectorAll('[id^="f-"]').forEach(b => b.classList.remove('btn-primary'));
  document.getElementById(`f-${type}`).classList.add('btn-primary');

  document.querySelectorAll('.alert-feed-item').forEach(item => {
    if (type === 'all' || item.classList.contains(type)) {
      item.style.display = 'flex';
    } else {
      item.style.display = 'none';
    }
  });
}
</script>
{% endblock %}
